<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 550">
  <defs>
    <linearGradient id="initialGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#9B59B6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#8E44AD;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="mainGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#3498DB;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#2980B9;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="finalGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#1ABC9C;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#16A085;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="eventGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#E74C3C;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#C0392B;stop-opacity:1" />
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.2"/>
    </filter>
    <marker id="arrowDown" markerWidth="10" markerHeight="7" refX="5" refY="7" orient="auto">
      <polygon points="0 0, 10 0, 5 7" fill="#666"/>
    </marker>
    <marker id="arrowUp" markerWidth="10" markerHeight="7" refX="5" refY="0" orient="auto">
      <polygon points="0 7, 10 7, 5 0" fill="#666"/>
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="400" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#333">
    Compose 触摸事件传递机制（三阶段）
  </text>

  <!-- PointerEvent source -->
  <g transform="translate(350, 60)">
    <rect x="0" y="0" width="100" height="40" rx="20" fill="url(#eventGrad)" filter="url(#shadow)"/>
    <text x="50" y="26" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" fill="white" font-weight="bold">PointerEvent</text>
  </g>
  
  <!-- Arrow down to Initial -->
  <line x1="400" y1="100" x2="400" y2="130" stroke="#666" stroke-width="2" marker-end="url(#arrowDown)"/>
  
  <!-- Component hierarchy visualization -->
  <g transform="translate(100, 140)">
    <!-- Outer container (Parent) -->
    <rect x="0" y="0" width="600" height="350" rx="15" fill="#f8f9fa" stroke="#dee2e6" stroke-width="2"/>
    <text x="300" y="25" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#666">父组件 (LazyColumn)</text>
    
    <!-- Middle container -->
    <rect x="40" y="45" width="520" height="280" rx="12" fill="#fff" stroke="#e9ecef" stroke-width="2"/>
    <text x="300" y="70" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" fill="#888">中间层</text>
    
    <!-- Inner component (KLineChart) -->
    <rect x="80" y="90" width="440" height="210" rx="10" fill="#FFF5E6" stroke="#F5A623" stroke-width="2"/>
    <text x="300" y="115" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" fill="#D48806" font-weight="bold">子组件 (KLineChart)</text>
  </g>
  
  <!-- Three Passes -->
  <!-- Initial Pass -->
  <g transform="translate(50, 180)">
    <rect x="0" y="0" width="140" height="100" rx="10" fill="url(#initialGrad)" filter="url(#shadow)"/>
    <text x="70" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="white" font-weight="bold">Initial Pass</text>
    <text x="70" y="50" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="rgba(255,255,255,0.9)">从外到内</text>
    <text x="70" y="70" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="rgba(255,255,255,0.8)">可以"偷看"事件</text>
    <text x="70" y="85" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="rgba(255,255,255,0.8)">拦截优先</text>
    
    <!-- Arrow pointing inward -->
    <path d="M 150 50 L 200 50 L 200 120 L 250 120" stroke="#9B59B6" stroke-width="3" fill="none" marker-end="url(#arrowDown)"/>
    <text x="225" y="85" font-family="Arial, sans-serif" font-size="20" fill="#9B59B6">↘</text>
  </g>
  
  <!-- Main Pass -->
  <g transform="translate(330, 280)">
    <rect x="0" y="0" width="140" height="100" rx="10" fill="url(#mainGrad)" filter="url(#shadow)"/>
    <text x="70" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="white" font-weight="bold">Main Pass</text>
    <text x="70" y="50" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="rgba(255,255,255,0.9)">从内到外</text>
    <text x="70" y="70" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="rgba(255,255,255,0.8)">主要处理阶段</text>
    <text x="70" y="85" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="rgba(255,255,255,0.8)">子组件优先</text>
    
    <!-- Arrow pointing outward -->
    <text x="-30" y="50" font-family="Arial, sans-serif" font-size="20" fill="#3498DB">↖</text>
  </g>
  
  <!-- Final Pass -->
  <g transform="translate(610, 180)">
    <rect x="0" y="0" width="140" height="100" rx="10" fill="url(#finalGrad)" filter="url(#shadow)"/>
    <text x="70" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="white" font-weight="bold">Final Pass</text>
    <text x="70" y="50" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="rgba(255,255,255,0.9)">从外到内</text>
    <text x="70" y="70" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="rgba(255,255,255,0.8)">最终处理</text>
    <text x="70" y="85" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="rgba(255,255,255,0.8)">清理工作</text>
    
    <!-- Arrow pointing inward -->
    <text x="-30" y="50" font-family="Arial, sans-serif" font-size="20" fill="#1ABC9C">↘</text>
  </g>
  
  <!-- Flow arrows between passes -->
  <g transform="translate(200, 420)">
    <line x1="0" y1="0" x2="150" y2="0" stroke="#666" stroke-width="2"/>
    <line x1="200" y1="0" x2="350" y2="0" stroke="#666" stroke-width="2"/>
    <circle cx="175" cy="0" r="15" fill="#9B59B6"/>
    <text x="175" y="5" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="white">1</text>
    <circle cx="375" cy="0" r="15" fill="#3498DB"/>
    <text x="375" y="5" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="white">2</text>
    <circle cx="500" cy="0" r="15" fill="#1ABC9C"/>
    <text x="500" y="5" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="white">3</text>
    <line x1="400" y1="0" x2="475" y2="0" stroke="#666" stroke-width="2"/>
  </g>
  
  <!-- Key insight box -->
  <g transform="translate(150, 500)">
    <rect x="0" y="0" width="500" height="40" rx="8" fill="#FFF3CD" stroke="#FFC107" stroke-width="1"/>
    <text x="20" y="25" font-family="Arial, sans-serif" font-size="12" fill="#856404">
      💡 关键：使用 Main Pass 可以让 LazyColumn 先处理事件，避免拦截垂直滚动
    </text>
  </g>
</svg>
