# Compose åµŒå¥—æ»šåŠ¨å†²çªå®Œå…¨æŒ‡å—

> ä»é›¶å¼€å§‹ç†è§£å¹¶è§£å†³ Compose ä¸­çš„åµŒå¥—æ»šåŠ¨å†²çªé—®é¢˜

---

## ğŸ“– ç›®å½•

1. [é—®é¢˜èƒŒæ™¯](#é—®é¢˜èƒŒæ™¯)
2. [é—®é¢˜æ˜¯æ€ä¹ˆå¯¼è‡´çš„](#é—®é¢˜æ˜¯æ€ä¹ˆå¯¼è‡´çš„)
3. [åŸç†æ·±åº¦è§£æ](#åŸç†æ·±åº¦è§£æ)
4. [è§£å†³æ–¹æ¡ˆ](#è§£å†³æ–¹æ¡ˆ)
   - [æ–¹æ¡ˆä¸€ï¼šNestedScrollDispatcherï¼ˆæ¨èç”¨äºç®€å•åœºæ™¯ï¼‰](#æ–¹æ¡ˆä¸€nestedscrolldispatcheræ¨èç”¨äºç®€å•åœºæ™¯)
   - [æ–¹æ¡ˆäºŒï¼šåˆ†ç¦»æ‰‹åŠ¿å¤„ç†å™¨ï¼ˆæ¨èç”¨äºå¤æ‚åœºæ™¯ï¼‰](#æ–¹æ¡ˆäºŒåˆ†ç¦»æ‰‹åŠ¿å¤„ç†å™¨æ¨èç”¨äºå¤æ‚åœºæ™¯)
5. [ä¸ºä»€ä¹ˆæŸäº›æ–¹æ¡ˆä¸å·¥ä½œ](#ä¸ºä»€ä¹ˆæŸäº›æ–¹æ¡ˆä¸å·¥ä½œ)
6. [æœ€ä½³å®è·µæ ‡å‡†](#æœ€ä½³å®è·µæ ‡å‡†)
7. [é‡åˆ°ç±»ä¼¼é—®é¢˜çš„æ’æŸ¥æŒ‡å—](#é‡åˆ°ç±»ä¼¼é—®é¢˜çš„æ’æŸ¥æŒ‡å—)

---

## é—®é¢˜èƒŒæ™¯

### åœºæ™¯æè¿°

æˆ‘ä»¬æœ‰ä¸€ä¸ª K çº¿å›¾ç»„ä»¶ï¼ˆKLineChartï¼‰ï¼Œå®ƒæ”¯æŒï¼š
- **æ°´å¹³æ»‘åŠ¨**ï¼šæµè§ˆå†å² K çº¿æ•°æ®
- **åŒæŒ‡ç¼©æ”¾**ï¼šè°ƒæ•´ K çº¿çš„æ—¶é—´ç²’åº¦
- **é•¿æŒ‰**ï¼šæ˜¾ç¤ºåå­—å…‰æ ‡æŸ¥çœ‹è¯¦æƒ…

è¿™ä¸ªç»„ä»¶è¢«åµŒå¥—åœ¨ä¸€ä¸ªå¯å‚ç›´æ»šåŠ¨çš„é¡µé¢ä¸­ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         SquareScreen            â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚    â”‚   (å¯å‚ç›´æ»šåŠ¨å®¹å™¨)    â”‚ â†•    â”‚
â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚      â”‚
â”‚    â”‚  â”‚   Header      â”‚  â”‚      â”‚
â”‚    â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚      â”‚
â”‚    â”‚  â”‚               â”‚  â”‚      â”‚
â”‚    â”‚  â”‚  KLineChart   â”‚ â†” â† æ°´å¹³æ»šåŠ¨
â”‚    â”‚  â”‚ (æ°´å¹³æ»šåŠ¨+ç¼©æ”¾) â”‚  â”‚      â”‚
â”‚    â”‚  â”‚               â”‚  â”‚      â”‚
â”‚    â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚      â”‚
â”‚    â”‚  â”‚   Footer      â”‚  â”‚      â”‚
â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚      â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“Š é—®é¢˜åœºæ™¯å›¾è§£

![é—®é¢˜åœºæ™¯](assets/é—®é¢˜åœºæ™¯.svg)

### é‡åˆ°çš„é—®é¢˜

1. **æ»šåŠ¨å¤±æ•ˆ**ï¼šåœ¨ K çº¿å›¾ä¸Šå‚ç›´æ»‘åŠ¨æ—¶ï¼Œæ•´ä¸ªé¡µé¢æ— æ³•æ»šåŠ¨
2. **ç¼©æ”¾åæ›´ä¸¥é‡**ï¼šåŒæŒ‡ç¼©æ”¾ K çº¿åï¼Œå‚ç›´æ»šåŠ¨å®Œå…¨å¤±æ•ˆ
3. **åå­—å…‰æ ‡è¯¯è§¦å‘**ï¼šå‚ç›´æ»‘åŠ¨æ—¶å®¹æ˜“æ„å¤–è§¦å‘åå­—å…‰æ ‡

---

## é—®é¢˜æ˜¯æ€ä¹ˆå¯¼è‡´çš„

### æ ¹æœ¬åŸå› ï¼šæ‰‹åŠ¿äº‹ä»¶è¢«"åƒæ‰"äº†

```
ç”¨æˆ·è§¦æ‘¸å±å¹•
     â”‚
     â–¼
è§¦æ‘¸äº‹ä»¶ç”Ÿæˆ
     â”‚
     â–¼
  è°å…ˆå¤„ç†?
     â”‚
     â”œâ”€â”€â†’ KLineChart çš„ pointerInput â”€â”€â†’ äº‹ä»¶è¢« consume() â”€â”€â†’ çˆ¶å®¹å™¨æ”¶ä¸åˆ°äº‹ä»¶! â”€â”€â†’ âŒ é¡µé¢æ— æ³•æ»šåŠ¨
     â”‚
     â””â”€â”€â†’ çˆ¶å®¹å™¨çš„ verticalScroll â”€â”€â†’ é¡µé¢æ»šåŠ¨ âœ…
```

### ä»£ç å±‚é¢çš„é—®é¢˜

```kotlin
// âŒ é—®é¢˜ä»£ç 
.pointerInput(state.mode) {
    awaitEachGesture {
        val down = awaitFirstDown(requireUnconsumed = false)  // æ•è· down äº‹ä»¶
        // ...
        do {
            val event = awaitPointerEvent()
            // å³ä½¿æ˜¯å‚ç›´æ»‘åŠ¨ï¼Œäº‹ä»¶ä¹Ÿè¢«è¿™ä¸ªå¾ªç¯æŒæœ‰
            // çˆ¶å®¹å™¨æ ¹æœ¬æ²¡æœºä¼šå¤„ç†ï¼
        } while (event.changes.any { it.pressed })
    }
}
```

**å…³é”®ç‚¹**ï¼š`awaitFirstDown(requireUnconsumed = false)` ä¼šæ•è·è§¦æ‘¸äº‹ä»¶çš„ "down" é˜¶æ®µã€‚ä¸€æ—¦è¢«æ•è·ï¼Œåç»­çš„ move å’Œ up äº‹ä»¶éƒ½ä¼šåœ¨è¿™ä¸ª `awaitEachGesture` å—ä¸­å¤„ç†ï¼Œçˆ¶å®¹å™¨æ— æ³•æ¥æ”¶å®Œæ•´çš„æ‰‹åŠ¿åºåˆ—ã€‚

---

## åŸç†æ·±åº¦è§£æ

### ğŸ“Š äº‹ä»¶ä¼ é€’æœºåˆ¶å›¾è§£

![äº‹ä»¶ä¼ é€’æœºåˆ¶](assets/äº‹ä»¶ä¼ é€’æœºåˆ¶.svg)

### Compose è§¦æ‘¸äº‹ä»¶ä¼ é€’æœºåˆ¶

Compose çš„æŒ‡é’ˆäº‹ä»¶ä¼ é€’åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼ˆPassï¼‰ï¼š

```
                    PointerEvent
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   Initial Pass      â”‚  â† æœ€æ—©é˜¶æ®µï¼Œå¯ä»¥"å·çœ‹"äº‹ä»¶
              â”‚   (ä»å¤–åˆ°å†…)         â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚    Main Pass        â”‚  â† ä¸»è¦å¤„ç†é˜¶æ®µ
              â”‚   (ä»å†…åˆ°å¤–)         â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚    Final Pass       â”‚  â† æœ€ç»ˆé˜¶æ®µ
              â”‚   (ä»å¤–åˆ°å†…)         â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### awaitEachGesture çš„"æŒæœ‰"é—®é¢˜

**`awaitEachGesture` + `awaitFirstDown` ä¼š"æŒæœ‰"æ•´ä¸ªæ‰‹åŠ¿åºåˆ—**ï¼š

```
æ—¶é—´çº¿ï¼š
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º

æ‰‹æŒ‡æŒ‰ä¸‹        æ‰‹æŒ‡ç§»åŠ¨        æ‰‹æŒ‡æŠ¬èµ·
   â”‚              â”‚              â”‚
   â–¼              â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     awaitEachGesture æŒæœ‰æœŸé—´      â”‚
â”‚                                  â”‚
â”‚  awaitFirstDown() æ•è· down äº‹ä»¶   â”‚
â”‚         â”‚                        â”‚
â”‚         â–¼                        â”‚
â”‚  æ­¤æ—¶ LazyColumn æ— æ³•è·å¾—æ§åˆ¶æƒï¼   â”‚
â”‚                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

å³ä½¿æˆ‘ä»¬åœ¨æ£€æµ‹åˆ°å‚ç›´æ»‘åŠ¨åï¼š
- ä¸æ¶ˆè´¹äº‹ä»¶ âŒ æ— æ•ˆ
- é€€å‡ºå¾ªç¯ âŒ æ— æ•ˆ
- é‡å¯ pointerInput âŒ æ— æ•ˆï¼ˆæ‰‹æŒ‡è¿˜åœ¨å±å¹•ä¸Šï¼Œæ–°çš„ awaitFirstDown ä¼šç«‹å³æ•è·ï¼‰

**å…³é”®æ´å¯Ÿ**ï¼šä¸€æ—¦ `awaitFirstDown` æ•è·äº† down äº‹ä»¶ï¼Œè¿™ä¸ªæ‰‹åŠ¿å°±"å±äº"æˆ‘ä»¬äº†ï¼Œæ— æ³•ä¸­é€”è½¬äº¤ç»™ LazyColumnã€‚

### åµŒå¥—æ»šåŠ¨ç³»ç»Ÿ (Nested Scroll System)

Compose æä¾›äº†ä¸“é—¨çš„åµŒå¥—æ»šåŠ¨åè®®æ¥è§£å†³è¿™ç±»å†²çªï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å­ç»„ä»¶                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              KLineChart                          â”‚   â”‚
â”‚  â”‚              NestedScrollDispatcher              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â”‚                               â”‚
â”‚         1. æ£€æµ‹åˆ°å‚ç›´æ»šåŠ¨ â”‚                               â”‚
â”‚                         â–¼                               â”‚
â”‚         2. dispatchPreScroll()                          â”‚
â”‚                         â”‚                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    çˆ¶ç»„ä»¶                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              verticalScroll                      â”‚   â”‚
â”‚  â”‚              NestedScrollConnection              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â”‚                               â”‚
â”‚         3. çˆ¶ç»„ä»¶å¤„ç†æ»šåŠ¨ â”‚                               â”‚
â”‚                         â–¼                               â”‚
â”‚         4. è¿”å›æ¶ˆè´¹é‡                                    â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒæ¦‚å¿µï¼š**

| ç»„ä»¶ | ä½œç”¨ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `NestedScrollConnection` | æ¥æ”¶æ¥è‡ªå­ç»„ä»¶çš„æ»šåŠ¨äº‹ä»¶ | çˆ¶ç»„ä»¶å®ç° |
| `NestedScrollDispatcher` | ä¸»åŠ¨å‘çˆ¶ç»„ä»¶å‘é€æ»šåŠ¨äº‹ä»¶ | å­ç»„ä»¶ä½¿ç”¨ |

---

## è§£å†³æ–¹æ¡ˆ

æ ¹æ®åœºæ™¯å¤æ‚åº¦ï¼Œæœ‰ä¸¤ç§æ¨èæ–¹æ¡ˆï¼š

### æ–¹æ¡ˆä¸€ï¼šNestedScrollDispatcherï¼ˆæ¨èç”¨äºç®€å•åœºæ™¯ï¼‰

é€‚ç”¨äºï¼šæ–¹å‘æ£€æµ‹åå¯ä»¥æ˜ç¡®åˆ†å‘ç»™çˆ¶å®¹å™¨çš„åœºæ™¯ã€‚

```kotlin
val nestedScrollDispatcher = remember { NestedScrollDispatcher() }

modifier
    .nestedScroll(nestedScrollConnection, nestedScrollDispatcher)
    .pointerInput(state.mode) {
        awaitEachGesture {
            var lockedOrientation = 0  // 0=æœªå®š, 1=æ°´å¹³, 2=å‚ç›´
            val down = awaitFirstDown(requireUnconsumed = false)
            
            do {
                val event = awaitPointerEvent()
                val panDelta = event.calculatePan()
                
                // æ–¹å‘æ£€æµ‹
                if (lockedOrientation == 0) {
                    if (abs(panDelta.x) > touchSlop || abs(panDelta.y) > touchSlop) {
                        lockedOrientation = if (abs(panDelta.x) > abs(panDelta.y)) 1 else 2
                    }
                }
                
                when (lockedOrientation) {
                    1 -> {
                        // æ°´å¹³æ¨¡å¼ï¼šè‡ªå·±å¤„ç†ï¼Œæ¶ˆè´¹äº‹ä»¶
                        state.scroll(-panDelta.x / scrollUnit)
                        event.changes.forEach { it.consume() }
                    }
                    2 -> {
                        // å‚ç›´æ¨¡å¼ï¼šé€šè¿‡ Dispatcher åˆ†å‘ç»™çˆ¶å®¹å™¨
                        val verticalDelta = Offset(0f, panDelta.y)
                        nestedScrollDispatcher.dispatchPreScroll(
                            available = verticalDelta,
                            source = NestedScrollSource.Drag
                        )
                        // ä¸æ¶ˆè´¹äº‹ä»¶ï¼
                    }
                }
            } while (event.changes.any { it.pressed })
        }
    }
```

**å±€é™æ€§**ï¼šè¿™ä¸ªæ–¹æ¡ˆåœ¨æŸäº›å¤æ‚åœºæ™¯ä¸‹å¯èƒ½å¤±æ•ˆï¼Œç‰¹åˆ«æ˜¯ï¼š
- è¿ç»­ç¼©æ”¾æ“ä½œå
- åŠ¨æ€æ·»åŠ /ç§»é™¤å­æŒ‡æ ‡å
- æ‰‹åŠ¿çŠ¶æ€æœºå¤æ‚æ—¶

### æ–¹æ¡ˆäºŒï¼šåˆ†ç¦»æ‰‹åŠ¿å¤„ç†å™¨ï¼ˆæ¨èç”¨äºå¤æ‚åœºæ™¯ï¼‰

é€‚ç”¨äºï¼šéœ€è¦åŒæ—¶æ”¯æŒæ°´å¹³æ»šåŠ¨ã€ç¼©æ”¾ã€é•¿æŒ‰ç­‰å¤šç§æ‰‹åŠ¿çš„å¤æ‚ç»„ä»¶ã€‚

### ğŸ“Š è§£å†³æ–¹æ¡ˆæ¶æ„å›¾

![è§£å†³æ–¹æ¡ˆ](assets/è§£å†³æ–¹æ¡ˆ.svg)

**æ ¸å¿ƒæ€è·¯**ï¼šå°†ä¸åŒç±»å‹çš„æ‰‹åŠ¿åˆ†ç¦»åˆ°ä¸åŒçš„ `pointerInput` å¤„ç†å™¨ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Modifier Chain                        â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  pointerInput #1: æ°´å¹³æ»šåŠ¨                        â”‚   â”‚
â”‚  â”‚  - ä½¿ç”¨è‡ªå®šä¹‰æ–¹å‘æ£€æµ‹                              â”‚   â”‚
â”‚  â”‚  - åªæœ‰ç¡®å®šæ˜¯æ°´å¹³æ—¶æ‰æ¶ˆè´¹äº‹ä»¶                       â”‚   â”‚
â”‚  â”‚  - å‚ç›´æ»‘åŠ¨æ—¶ç«‹å³é€€å‡ºï¼Œä¸æŒæœ‰æ‰‹åŠ¿                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â”‚                               â”‚
â”‚                         â–¼                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  pointerInput #2: ç¼©æ”¾                           â”‚   â”‚
â”‚  â”‚  - åªå¤„ç†å¤šæŒ‡æ‰‹åŠ¿                                 â”‚   â”‚
â”‚  â”‚  - å•æŒ‡æ—¶ä¸å¹²é¢„                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â”‚                               â”‚
â”‚                         â–¼                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  LazyColumn çš„æ»šåŠ¨å¤„ç†                            â”‚   â”‚
â”‚  â”‚  - æ¥æ”¶æœªè¢«æ¶ˆè´¹çš„å‚ç›´æ»šåŠ¨äº‹ä»¶                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®ç°ä»£ç **ï¼š

```kotlin
fun createGestureModifier(): Modifier {
    return Modifier
        // 1. æ°´å¹³æ»šåŠ¨ - å¸¦è§’åº¦å®¹å·®çš„æ–¹å‘æ£€æµ‹
        .pointerInput(Unit) {
            handleHorizontalScrollWithTolerance()
        }
        // 2. ç¼©æ”¾ - åªå¤„ç†å¤šæŒ‡æ‰‹åŠ¿
        .pointerInput(Unit) {
            handleZoomGestures()
        }
}

/**
 * æ°´å¹³æ»šåŠ¨å¤„ç† - å…³é”®å®ç°
 */
private suspend fun PointerInputScope.handleHorizontalScrollWithTolerance() {
    val velocityTracker = VelocityTracker()
    
    awaitEachGesture {
        val down = awaitFirstDown(requireUnconsumed = false)
        velocityTracker.resetTracking()
        
        var totalDragX = 0f
        var totalDragY = 0f
        var isHorizontalLocked = false
        val touchSlop = viewConfiguration.touchSlop
        
        while (true) {
            // âš ï¸ å…³é”®ï¼šä½¿ç”¨ Main passï¼Œè®©å…¶ä»–å¤„ç†å™¨æœ‰æœºä¼šå…ˆå¤„ç†
            val event = awaitPointerEvent(PointerEventPass.Main)
            
            if (event.changes.all { !it.pressed }) {
                // æ‰‹æŒ‡æŠ¬èµ·ï¼Œè§¦å‘æƒ¯æ€§æ»‘åŠ¨
                if (isHorizontalLocked) {
                    val velocity = velocityTracker.calculateVelocity()
                    flingController.startFling(velocity.x)
                }
                break
            }
            
            if (event.changes.any { it.isConsumed }) continue
            
            val change = event.changes.firstOrNull() ?: continue
            
            // å¤šæŒ‡è§¦æ‘¸æ—¶é€€å‡ºï¼Œè®©ç¼©æ”¾å¤„ç†å™¨æ¥ç®¡
            if (event.changes.size > 1) break
            
            velocityTracker.addPosition(change.uptimeMillis, change.position)
            
            val dragX = change.positionChange().x
            val dragY = change.positionChange().y
            
            if (!isHorizontalLocked) {
                totalDragX += dragX
                totalDragY += dragY
                
                if (abs(totalDragX) > touchSlop || abs(totalDragY) > touchSlop) {
                    // è§’åº¦å®¹å·®ï¼šå…è®¸çº¦ 63 åº¦çš„æ–œå‘æ»‘åŠ¨
                    if (abs(totalDragX) > abs(totalDragY) * 2) {
                        // âœ… æ°´å¹³æ»‘åŠ¨ - é”å®šå¹¶å¤„ç†
                        isHorizontalLocked = true
                        applyScroll(totalDragX)
                        change.consume()
                    } else {
                        // âœ… å‚ç›´æ»‘åŠ¨ - ç«‹å³é€€å‡ºï¼
                        // å…³é”®ï¼šä¸æ¶ˆè´¹ä»»ä½•äº‹ä»¶ï¼Œè®© LazyColumn å¤„ç†
                        break
                    }
                }
            } else {
                applyScroll(dragX)
                change.consume()
            }
        }
    }
}

/**
 * ç¼©æ”¾å¤„ç† - åªå¤„ç†å¤šæŒ‡
 */
private suspend fun PointerInputScope.handleZoomGestures() {
    awaitEachGesture {
        awaitFirstDown(requireUnconsumed = false)
        
        var isZooming = false
        
        while (true) {
            val event = awaitPointerEvent(PointerEventPass.Initial)
            
            if (event.changes.all { !it.pressed }) break
            
            val pointerCount = event.changes.count { it.pressed }
            
            // åªæœ‰å¤šæŒ‡æ—¶æ‰å¤„ç†
            if (pointerCount >= 2) {
                isZooming = true
                val zoom = event.calculateZoom()
                if (zoom != 1f) {
                    applyZoom(zoom)
                }
                event.changes.forEach { it.consume() }
            }
        }
    }
}
```

### è§’åº¦å®¹å·®å›¾è§£

ä¸ºäº†æå‡ç”¨æˆ·ä½“éªŒï¼Œå…è®¸è½»å¾®æ–œå‘çš„æ»‘åŠ¨ä¹Ÿè¢«è¯†åˆ«ä¸ºæ°´å¹³æ»‘åŠ¨ï¼š

### ğŸ“Š è§’åº¦å®¹å·®å¯è§†åŒ–

![è§’åº¦å®¹å·®](assets/è§’åº¦å®¹å·®.svg)

```
                    90Â° (çº¯å‚ç›´)
                        â”‚
                        â”‚
            â•²           â”‚           â•±
             â•²  å‚ç›´åŒºåŸŸ  â”‚  å‚ç›´åŒºåŸŸ  â•±
              â•²         â”‚         â•±
               â•²        â”‚        â•±
                â•²       â”‚       â•±
                 â•²      â”‚      â•±    çº¦ 63Â°
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•²â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â•±â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  0Â° (çº¯æ°´å¹³)
                   â•²    â”‚    â•±
                    â•²   â”‚   â•±
                     â•²  â”‚  â•±
                      â•² â”‚ â•±
                       â•²â”‚â•±
                        â”‚
                        â”‚
                    
    æ°´å¹³åŒºåŸŸï¼š|dx| > |dy| Ã— 2  (tolerance = 0.5)
    å‚ç›´åŒºåŸŸï¼šå…¶ä»–
```

---

## ä¸ºä»€ä¹ˆæŸäº›æ–¹æ¡ˆä¸å·¥ä½œ

### âŒ æ–¹æ¡ˆ Aï¼šæ£€æµ‹åˆ°å‚ç›´åä¸æ¶ˆè´¹äº‹ä»¶

```kotlin
if (isVertical) {
    // ä¸æ¶ˆè´¹ï¼ŒæœŸæœ› LazyColumn å¤„ç†
    continue
}
```

**å¤±è´¥åŸå› **ï¼š`awaitEachGesture` ä»åœ¨è¿è¡Œï¼ŒæŒæœ‰æ•´ä¸ªæ‰‹åŠ¿åºåˆ—ã€‚äº‹ä»¶è™½ç„¶æ²¡è¢«æ¶ˆè´¹ï¼Œä½† LazyColumn æ— æ³•è·å¾—å®Œæ•´çš„æ‰‹åŠ¿åºåˆ—ï¼ˆç¼ºå°‘ down äº‹ä»¶ï¼‰ã€‚

### âŒ æ–¹æ¡ˆ Bï¼šæ£€æµ‹åˆ°å‚ç›´åé€€å‡ºå¾ªç¯

```kotlin
if (isVertical) {
    break // é€€å‡ºå¾ªç¯
}
```

**å¤±è´¥åŸå› **ï¼šé€€å‡ºå `awaitEachGesture` ä¼šç­‰å¾…æ‰‹åŠ¿ç»“æŸï¼Œç„¶åå¼€å§‹ä¸‹ä¸€ä¸ªå‘¨æœŸã€‚å½“å‰æ‰‹åŠ¿å·²ç»è¢«"å ç”¨"ï¼ŒLazyColumn ä»ç„¶æ— æ³•å¤„ç†ã€‚

### âŒ æ–¹æ¡ˆ Cï¼šé‡å¯ pointerInput

```kotlin
var restartKey by remember { mutableStateOf(0) }

.pointerInput(restartKey) {
    awaitEachGesture {
        if (isVertical) {
            restartKey++ // è§¦å‘ pointerInput é‡å¯
            return@awaitEachGesture
        }
    }
}
```

**å¤±è´¥åŸå› **ï¼šé‡å¯åæ–°çš„ `awaitFirstDown` ä¼šç«‹å³æ•è·å½“å‰å·²æŒ‰ä¸‹çš„æ‰‹æŒ‡ã€‚æ‰‹æŒ‡è¿˜åœ¨å±å¹•ä¸Šï¼Œæ–°çš„æ‰‹åŠ¿å¤„ç†å™¨ä¼šç«‹å³"æ¥ç®¡"ã€‚

### âŒ æ–¹æ¡ˆ Dï¼šä½¿ç”¨ PointerEventPass.Initial

```kotlin
val event = awaitPointerEvent(PointerEventPass.Initial)
```

**å¤±è´¥åŸå› **ï¼šInitial pass ä¼šåœ¨ LazyColumn ä¹‹å‰æ‹¦æˆªäº‹ä»¶ï¼Œå³ä½¿ä¸æ¶ˆè´¹ä¹Ÿä¼šå½±å“äº‹ä»¶æµã€‚LazyColumn çš„æ»šåŠ¨æ£€æµ‹ä¾èµ–äºå®Œæ•´çš„äº‹ä»¶åºåˆ—ã€‚

### âœ… æ­£ç¡®æ–¹æ¡ˆï¼šåˆ†ç¦» + Main Pass + æ—©æœŸé€€å‡º

```kotlin
// ä½¿ç”¨ Main pass
val event = awaitPointerEvent(PointerEventPass.Main)

// æ£€æµ‹åˆ°å‚ç›´æ—¶ç«‹å³é€€å‡ºï¼Œä¸åšä»»ä½•å¤„ç†
if (isVertical) {
    break // å…³é”®ï¼šåœ¨æ–¹å‘ç¡®å®šå‰å°±é€€å‡ºï¼Œä¸æ¶ˆè´¹ä»»ä½•äº‹ä»¶
}
```

**ä¸ºä»€ä¹ˆæœ‰æ•ˆ**ï¼š
1. ä½¿ç”¨ `Main` pass è€Œä¸æ˜¯ `Initial`ï¼Œä¸ä¼šé˜»æ–­äº‹ä»¶æµ
2. åœ¨æ–¹å‘ç¡®å®šå‰é€€å‡ºï¼Œæ²¡æœ‰æ¶ˆè´¹ä»»ä½•äº‹ä»¶
3. LazyColumn å¯ä»¥æ¥æ”¶åˆ°å®Œæ•´çš„æ‰‹åŠ¿åºåˆ—

---

## æœ€ä½³å®è·µæ ‡å‡†

### ğŸ“Š Modifier é“¾æœ€ä½³å®è·µ

![æœ€ä½³å®è·µ](assets/æœ€ä½³å®è·µ.svg)

### 1. Modifier é“¾çš„æ­£ç¡®é¡ºåº

```kotlin
Canvas(
    modifier = Modifier
        // 1ï¸âƒ£ é¦–å…ˆï¼šåµŒå¥—æ»šåŠ¨è¿æ¥ï¼ˆå¦‚æœä½¿ç”¨æ–¹æ¡ˆä¸€ï¼‰
        .nestedScroll(connection, dispatcher)
        
        // 2ï¸âƒ£ å…¶æ¬¡ï¼šç®€å•æ‰‹åŠ¿ï¼ˆç‚¹å‡»ã€é•¿æŒ‰ï¼‰
        .pointerInput(key) { detectTapGestures { ... } }
        .pointerInput(key) { detectDragGesturesAfterLongPress { ... } }
        
        // 3ï¸âƒ£ æœ€åï¼šå¤æ‚æ‰‹åŠ¿ï¼ˆæ»šåŠ¨ã€ç¼©æ”¾ï¼‰
        .pointerInput(key) { 
            awaitEachGesture { ... }
        }
)
```

### 2. æ–¹å‘é”å®šçŠ¶æ€æœº

```kotlin
// æ–¹å‘é”å®šçŠ¶æ€
var lockedOrientation = 0  // 0=æœªå®š, 1=æ°´å¹³, 2=å‚ç›´

// æ–¹å‘æ£€æµ‹ï¼ˆå¸¦è§’åº¦å®¹å·®ï¼‰
if (lockedOrientation == 0) {
    accumulatedPan += panDelta
    
    val absDx = abs(accumulatedPan.x)
    val absDy = abs(accumulatedPan.y)
    
    if (absDx > touchSlop || absDy > touchSlop) {
        // tolerance = 0.5 æ„å‘³ç€ |dx| > |dy| * 2 æ‰ç®—æ°´å¹³
        lockedOrientation = if (absDx > absDy * 2) {
            1  // æ°´å¹³ â†’ è‡ªå·±å¤„ç†
        } else {
            2  // å‚ç›´ â†’ åˆ†å‘ç»™çˆ¶å®¹å™¨æˆ–é€€å‡º
        }
    }
}
```

### 3. äº‹ä»¶æ¶ˆè´¹åŸåˆ™

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    äº‹ä»¶æ¶ˆè´¹å†³ç­–æ ‘                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚   Q: è¿™ä¸ªäº‹ä»¶æˆ‘éœ€è¦å¤„ç†å—ï¼Ÿ                              â”‚
â”‚                                                         â”‚
â”‚   â”œâ”€â”€ æ˜¯ï¼ˆæ°´å¹³æ»šåŠ¨/ç¼©æ”¾ï¼‰                                â”‚
â”‚   â”‚   â””â”€â”€ consume() å¹¶å¤„ç†                              â”‚
â”‚   â”‚                                                     â”‚
â”‚   â””â”€â”€ å¦ï¼ˆå‚ç›´æ»šåŠ¨ï¼‰                                     â”‚
â”‚       â”‚                                                 â”‚
â”‚       â”œâ”€â”€ æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨ NestedScrollDispatcher åˆ†å‘       â”‚
â”‚       â”‚                                                 â”‚
â”‚       â””â”€â”€ æ–¹æ¡ˆäºŒï¼šç«‹å³é€€å‡º awaitEachGesture              â”‚
â”‚           ï¼ˆä¸æ¶ˆè´¹ä»»ä½•äº‹ä»¶ï¼Œè®© LazyColumn è‡ªç„¶å¤„ç†ï¼‰       â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. æŠ¬èµ·æ‰‹æŒ‡çš„å¤„ç†

```kotlin
fun onRelease() {
    // âœ… æ€»æ˜¯æ¸…ç†çŠ¶æ€
    if (mode == ChartMode.CROSSHAIR) {
        mode = ChartMode.SCROLLING
        crosshairIndex = -1
    }
    // é‡ç½®æ–¹å‘é”å®š
    lockedOrientation = 0
}
```

---

## é‡åˆ°ç±»ä¼¼é—®é¢˜çš„æ’æŸ¥æŒ‡å—

### ğŸ” è¯Šæ–­æ¸…å•

```
â–¡ 1. ç¡®è®¤é—®é¢˜ç°è±¡
    - å“ªä¸ªæ–¹å‘çš„æ»šåŠ¨å¤±æ•ˆï¼Ÿ
    - ä»€ä¹ˆæ“ä½œåå¤±æ•ˆï¼Ÿï¼ˆç¼©æ”¾ï¼Ÿé•¿æŒ‰ï¼Ÿï¼‰
    - æ˜¯å®Œå…¨å¤±æ•ˆè¿˜æ˜¯å¶å‘ï¼Ÿ

â–¡ 2. æ£€æŸ¥ Modifier é“¾
    - pointerInput çš„é¡ºåºæ˜¯å¦æ­£ç¡®ï¼Ÿ
    - æ˜¯å¦ä½¿ç”¨äº† nestedScrollï¼Ÿ
    - key å‚æ•°æ˜¯å¦ä¼šå¯¼è‡´æ„å¤–é‡å»ºï¼Ÿ

â–¡ 3. æ£€æŸ¥äº‹ä»¶æ¶ˆè´¹
    - æ˜¯å¦æœ‰ä¸å¿…è¦çš„ consume() è°ƒç”¨ï¼Ÿ
    - consume() çš„æ¡ä»¶æ˜¯å¦æ­£ç¡®ï¼Ÿ

â–¡ 4. æ£€æŸ¥æ‰‹åŠ¿æ£€æµ‹å™¨
    - awaitFirstDown çš„ requireUnconsumed å‚æ•°ï¼Ÿ
    - æ˜¯å¦æœ‰å¤šä¸ªæ‰‹åŠ¿æ£€æµ‹å™¨ç«äº‰ï¼Ÿ
    - ä½¿ç”¨çš„æ˜¯ Initial è¿˜æ˜¯ Main passï¼Ÿ
```

### ğŸ› ï¸ å¸¸è§é—®é¢˜é€ŸæŸ¥

| ç—‡çŠ¶ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|----------|----------|
| åµŒå¥—æ»šåŠ¨å®Œå…¨å¤±æ•ˆ | pointerInput consume æ‰€æœ‰äº‹ä»¶ | ä½¿ç”¨æ–¹æ¡ˆä¸€æˆ–æ–¹æ¡ˆäºŒ |
| ç¼©æ”¾åæ»šåŠ¨å¤±æ•ˆ | æ–¹å‘é”å®šæœªæ­£ç¡®é‡ç½® | åˆ†ç¦»ç¼©æ”¾å’Œæ»šåŠ¨å¤„ç†å™¨ |
| é•¿æŒ‰è¯¯è§¦å‘ | æ‰‹åŠ¿æ£€æµ‹å™¨é¡ºåºé—®é¢˜ | è°ƒæ•´ pointerInput é¡ºåº |
| æ»šåŠ¨ä¸æµç•… | äº‹ä»¶å¤„ç†é˜»å¡ | ä¼˜åŒ–æ–¹å‘æ£€æµ‹é€»è¾‘ |
| æ–œå‘æ»‘åŠ¨ä½“éªŒå·® | æ–¹å‘æ£€æµ‹å¤ªä¸¥æ ¼ | æ·»åŠ è§’åº¦å®¹å·® |

### ğŸ“ æ¶æ„å†³ç­–æµç¨‹

### ğŸ“Š æ¶æ„å†³ç­–æµç¨‹å›¾

![æ¶æ„å†³ç­–](assets/æ¶æ„å†³ç­–.svg)

```
éœ€è¦è‡ªå®šä¹‰æ‰‹åŠ¿?
    â”‚
    â”œâ”€â”€ å¦ â†’ ä½¿ç”¨å†…ç½® Modifier (scrollable, draggable) â†’ è‡ªåŠ¨å‚ä¸åµŒå¥—æ»šåŠ¨ âœ…
    â”‚
    â””â”€â”€ æ˜¯ â†’ ä½¿ç”¨ pointerInput
              â”‚
              â””â”€â”€ ä¼šåµŒå¥—åœ¨æ»šåŠ¨å®¹å™¨ä¸­?
                    â”‚
                    â”œâ”€â”€ å¦ â†’ ç›´æ¥å¤„ç†äº‹ä»¶
                    â”‚
                    â””â”€â”€ æ˜¯ â†’ é€‰æ‹©æ–¹æ¡ˆï¼š
                              â”‚
                              â”œâ”€â”€ ç®€å•åœºæ™¯ â†’ æ–¹æ¡ˆä¸€ï¼šNestedScrollDispatcher
                              â”‚
                              â””â”€â”€ å¤æ‚åœºæ™¯ â†’ æ–¹æ¡ˆäºŒï¼šåˆ†ç¦»æ‰‹åŠ¿å¤„ç†å™¨
```

---

## ğŸ’¡ æ€»ç»“

### æ ¸å¿ƒè¦ç‚¹

1. **ç†è§£äº‹ä»¶æµ**ï¼šè§¦æ‘¸äº‹ä»¶ä»å¤–åˆ°å†…ä¼ é€’ï¼Œ`consume()` ä¼šé˜»æ­¢ç»§ç»­ä¼ é€’
2. **ç†è§£ awaitEachGesture**ï¼šä¸€æ—¦ `awaitFirstDown` æ•è·äº‹ä»¶ï¼Œæ•´ä¸ªæ‰‹åŠ¿åºåˆ—å°±è¢«"æŒæœ‰"
3. **ä¸¤ç§è§£å†³æ–¹æ¡ˆ**ï¼š
   - ç®€å•åœºæ™¯ï¼š`NestedScrollDispatcher` ä¸»åŠ¨åˆ†å‘
   - å¤æ‚åœºæ™¯ï¼šåˆ†ç¦»æ‰‹åŠ¿å¤„ç†å™¨ + Main Pass + æ—©æœŸé€€å‡º
4. **æ–¹å‘é”å®š**ï¼šä¸€æ—¦ç¡®å®šæ»‘åŠ¨æ–¹å‘ï¼Œå°±é”å®šå¹¶ä¸€è‡´å¤„ç†
5. **è§’åº¦å®¹å·®**ï¼šå…è®¸è½»å¾®æ–œå‘æ»‘åŠ¨ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
6. **æ¸…ç†çŠ¶æ€**ï¼šæ‰‹æŒ‡æŠ¬èµ·æ—¶åŠ¡å¿…é‡ç½®æ‰€æœ‰çŠ¶æ€

### æ–¹æ¡ˆå¯¹æ¯”

| ç‰¹æ€§ | æ–¹æ¡ˆä¸€ï¼šNestedScrollDispatcher | æ–¹æ¡ˆäºŒï¼šåˆ†ç¦»æ‰‹åŠ¿å¤„ç†å™¨ |
|------|-------------------------------|----------------------|
| å¤æ‚åº¦ | è¾ƒä½ | è¾ƒé«˜ |
| é€‚ç”¨åœºæ™¯ | ç®€å•çš„æ–¹å‘åˆ†å‘ | å¤æ‚çš„å¤šæ‰‹åŠ¿ç»„åˆ |
| ç¼©æ”¾åç¨³å®šæ€§ | å¯èƒ½æœ‰é—®é¢˜ | ç¨³å®š |
| ä»£ç ä¾µå…¥æ€§ | éœ€è¦ä¿®æ”¹ç°æœ‰æ‰‹åŠ¿å¤„ç† | é‡æ„æ‰‹åŠ¿æ¶æ„ |
| æ¨èåº¦ | å…ˆå°è¯• | æ–¹æ¡ˆä¸€å¤±æ•ˆæ—¶ä½¿ç”¨ |

### å…³é”®ä»£ç æ¨¡å¼

```kotlin
// åµŒå¥—æ»šåŠ¨ç»„ä»¶çš„æ ‡å‡†æ¨¡æ¿ï¼ˆæ–¹æ¡ˆäºŒï¼‰
@Composable
fun NestedScrollableComponent(modifier: Modifier = Modifier) {
    Box(
        modifier = modifier
            // æ°´å¹³æ»šåŠ¨ï¼šä½¿ç”¨ Main pass + æ—©æœŸæ–¹å‘æ£€æµ‹
            .pointerInput(Unit) {
                awaitEachGesture {
                    val down = awaitFirstDown(requireUnconsumed = false)
                    var orientation = 0
                    
                    while (true) {
                        val event = awaitPointerEvent(PointerEventPass.Main)
                        if (event.changes.all { !it.pressed }) break
                        
                        val delta = event.changes.first().positionChange()
                        
                        if (orientation == 0) {
                            if (abs(delta.x) > touchSlop || abs(delta.y) > touchSlop) {
                                if (abs(delta.x) > abs(delta.y) * 2) {
                                    orientation = 1  // æ°´å¹³
                                } else {
                                    break  // å‚ç›´ - ç«‹å³é€€å‡ºï¼
                                }
                            }
                        }
                        
                        if (orientation == 1) {
                            handleHorizontal(delta)
                            event.changes.forEach { it.consume() }
                        }
                    }
                }
            }
            // ç¼©æ”¾ï¼šåªå¤„ç†å¤šæŒ‡
            .pointerInput(Unit) {
                awaitEachGesture {
                    awaitFirstDown(requireUnconsumed = false)
                    while (true) {
                        val event = awaitPointerEvent(PointerEventPass.Initial)
                        if (event.changes.all { !it.pressed }) break
                        if (event.changes.count { it.pressed } >= 2) {
                            handleZoom(event.calculateZoom())
                            event.changes.forEach { it.consume() }
                        }
                    }
                }
            }
    )
}
```

---

> ğŸ“š **å»¶ä¼¸é˜…è¯»**
> - [Compose å®˜æ–¹åµŒå¥—æ»šåŠ¨æ–‡æ¡£](https://developer.android.com/develop/ui/compose/touch-input/pointer-input/scroll)
> - [PointerInput æ·±åº¦è§£æ](https://developer.android.com/develop/ui/compose/touch-input/pointer-input/understand-gestures)
